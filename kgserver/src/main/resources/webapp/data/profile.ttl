#
# SWS profile: a construct query and a HTML transformation
# st:param specify parameters passed to transformation 
# accessible using st:get(st:lang)
#

prefix p:    <http://fr.dbpedia.org/property/>
prefix o:    <http://dbpedia.org/ontology/>


[] owl:imports <profile-test.ttl>


st:dbpedia a st:Profile ;   
  st:param [ 
    st:lang "fr" ;
    st:import st:dbpediaParam, st:mapParam  ;    
  ] ;
  st:workflow st:dbpediawf
  .
  
st:dbpediawf a sw:Workflow ;
  sw:body ( 
    <query/frdbpedia.rq> <query/frdbpediaclean.rq> 
    [ a sw:Template ; sw:uri st:navlab ]
  )
.
  

st:dbedit a st:Profile ;
  st:param [
    st:uri <http://ns.inria.fr/sparql-template/date/09/2015> ;
    # include &mode=st:get(st:mode) to hypertext link to server
    # st:include (st:mode)
  ] ;
  st:transform st:dbedit .
  

  
st:mapParam
    st:param [ 
        st:mapzoom 6 ;
        st:mapsize "mapmedium" ;
        st:mapicon1 "/img/bmarker.png" ;
        st:mapicon2 "/img/smarker.png" 
      ]  .
  
st:dbpediaParam 
  st:param [
  
  st:person (
          (p:dateDeNaissance 	"Naissance" 	"Birth")
	  (p:dateDeDécès 	"Décès"		"Death")
	  (o:predecessor 	"Prédécesseur"	"Predecessor")
	  (o:successor          "Successeur"	"Successor")
	  (o:father 		"Père"		"Father")
	  (o:mother 		"Mère"		"Mother")
	  (o:spouse 		"Conjoints"	"Spouse")
	  (o:child 		"Enfants"	"Children")
	  (o:residence          "Résidence"	"Residence")
	  (rdfs:comment 	"Résumé"	"Abstract")
	  (o:wikiPageRedirects  "Voir aussi"	"See Also")
	  (o:wikipedia          "Wikipedia"	"Wikipedia")
	  (o:dbpedia		"DBpedia"	"DBpedia"))
  ] .
  
st:dbpediaen a st:Profile ;
  st:query  <query/frdbpediaen.rq> ;
  st:transform  st:navlab ;
  st:param [
    st:lang "en" ;
  ] .
  
st:calendar a st:Profile ;
  st:transform st:calendar ;
  st:param [
    st:debug true ;
  ] .
  
 
st:calendar1 a st:Profile ;
  st:query     <query/dbpediadate.rq> ;  
  st:transform st:content ;
   st:param [
    st:uri   st:y2000 ;
    st:title "Born calendar";
  ] .

st:calendar2 a st:Profile ;
  st:query     <query/dbpediadate2.rq> ;
  st:transform st:content ;
  st:param [
    st:uri    st:y2000 ;
    st:title "Decease calendar";
  ] .
  
st:calendar3 a st:Profile ;
  st:query     <query/dbpediadate3.rq> ;
  st:transform st:content ;  
  st:param [
    st:uri    st:y1944 ;
    st:title "Event calendar";
  ] .

@prefix ct: <http://ns.inria.fr/sparql-template/content#>

# calendar to query dbpedia for event given month-day for any year
# show answer of such query
st:gcalendar a st:Profile ;
  st:query     <query/dbpediadatemd.rq> ;
  st:transform ct:query ;  
  st:param [
    st:import st:cal ;
    st:title "Born calendar";
  ] .
  
# additional shared param
st:cal 
  st:param [
    st:uri    st:d2000-02-29 ;
].
  
  
st:gcalendar2 a st:Profile ;
  st:query     <query/dbpediadatemd2.rq> ;
  st:transform ct:query ;  
  st:param [
    st:import st:cal ;
    st:title "Decease calendar";
  ] .
  
st:gcalendar3 a st:Profile ;
  st:query  <query/dbpediadatemd3.rq> ;
  st:transform ct:query ; 
   st:param [
    st:import st:cal ;
    st:title "Born & Decease calendar";
  ] .
  

st:dbpediasparql a st:Profile ;
  st:query     <query/frdbpedia.rq> ;
  st:transform st:sparql .


st:dbpediacopy a st:Profile ;
  st:query     <query/frdbpediacopy.rq> ;
  st:transform st:navlab .
  

st:navlab a st:Profile ;
  st:workflow [ 
    sw:body ( [ a sw:Template ; sw:uri st:navlab ] ) 
  ] .

st:web a st:Profile ;
   st:transform st:web .

st:weben a st:Profile ;
   st:param [ st:lang 'en' ];
   st:transform st:web .

   # LDP on local dataset
st:sparql a st:Profile ;
    st:query <query/construct.rq> ;
    st:variable "?r" ;
    st:transform st:sparql .

    # LDP on target URI
st:std a st:Profile ;
    st:query <query/construct.rq> ;
    st:variable "?r" ;
    st:transform st:sparql .

st:rdfs a st:Profile ;
    st:transform st:rdfs .
    

    
# ******************************************************
#
#    Server Content
#
# ******************************************************
 
 
st:default a st:Server ;
st:content [
  a sw:Workflow ; sw:body (
    [ a sw:Load ; sw:path <tutorial/human1.rdf>  ; sw:name st:data1 ] 
    [ a sw:Load ; sw:path <tutorial/human2.rdf>  ; sw:name st:data2 ] 
    [ a sw:Load ; sw:path <tutorial/pragma.ttl>  ; sw:name st:pragma ]    
  )]
.


st:tutorial1 a st:Server ;
  st:service "rdf" ;
  st:transform st:web ;
  st:content 
  [ a sw:Workflow ; sw:body ( 

    [ a sw:Parallel ; sw:body (
    
      # main dataset
      [ a sw:Workflow ;  sw:body (
	  [ a sw:Load ; sw:path <tutorial/human1.rdf> ; sw:name st:data1 ]
	  [ a sw:Load ; sw:path <tutorial/human2.rdf> ; sw:name st:data2 ]
	  [ a sw:Load ; sw:path <tutorial/pragma.ttl> ; sw:name st:pragma ]  
      )] 
      
      # context dataset with predefined queries in a specific graph
      [ a sw:Workflow ; sw:name st:context ; sw:body ( 
	  [ a sw:Query ; sw:body "construct where {}" ]
	  [ a sw:Load ; sw:path <tutorial/workflow.ttl>  ; sw:name st:context ]
	  st:indexQuery) ]
    )]
    
    [a sw:Dataset]

  )]
.

 st:indexQuery a sw:Query ; 
   sw:body 
   "insert { ?q st:index ?n } where { ?q a sw:Query bind (kg:number() as ?n) }"
.
  
  


 
   
# execute the whole query list of the tutorial above
st:tutocheck a st:Profile ;
   st:workflow  
      [ a sw:Workflow ; sw:uri <tutorial/workflow.ttl>  ]      
. 



st:tutorial1save a st:Server ;
  st:service "rdfsave" ;
  st:transform st:web ;
  st:data     
    [ st:uri <tutorial/human1.rdf>  ; st:name st:data1 ] ,
    [ st:uri <tutorial/human2.rdf>  ; st:name st:data2 ] ,
    [ st:uri <tutorial/pragma.ttl>  ; st:name st:pragma ] ;
  st:context  [ st:uri <tutorial/tutorial.ttl>  ; st:name st:context ] .
         
  

  
st:rome a st:Server ;   
  st:service "rome" ;
  st:param [ 
    st:lang "fr" ;
    st:import st:dbpediaParam, st:mapParam  ;   
  ] ;
  st:data [st:uri <dbpedia/rome.ttl> ; st:name st:data ] ;
  st:transform  st:navlab .   
  
  
# geographic enclaves   
st:geo a st:Server ;
  st:service "geo" ;
  st:transform st:navlab ; 
  st:param [ 
    st:lang "en"   ;
    st:mapzoom 5 ;
    st:mapsize "maplarge" ;
    st:import  st:mapParam  ;
  ] ;
  st:data     
    [ st:uri <dbpedia/dbpedia.ttl>  ; st:name st:geo ] .
    


  
@prefix cn: <http://cdn.fr/schema/>
  
# /tutorial/cdn

st:cdn a st:Server ;
    st:service "cdn" ;
    st:transform st:cdn ;
    
    st:param [
      st:import st:history
    ] ;
    
    st:content 
      [ a sw:Workflow ; sw:body ( 
	[ a sw:Load ; sw:path 
	<cdn/aa_siecle.ttl> ,  <cdn/fr.ttl> , 
	<cdn/spqr.ttl> , <cdn/franc.ttl> , <cdn/eds.ttl> , 
	<cdn/emp.ttl> ,     <cdn/provence.ttl> ,  <cdn/icon.rdf> , 
	<cdn/icon.ttl> ,    <cdn/context.ttl> ,  
	<cdn/an1000.ttl> ,  <cdn/an1100.ttl> , 
	<cdn/an1200.ttl> ,  <cdn/an1300.ttl> ,   <cdn/an1400.ttl> , 
	<cdn/an1500.ttl> ,  <cdn/an1600.ttl> ,  <cdn/an1700.ttl> , 
	<cdn/an1800.ttl> ,  <cdn/an1900.ttl> ,  <cdn/pos.ttl> 	
	] ) ]    
  .  
    
    
    
 st:history a st:Profile ;
    st:transform st:cdn ;        
    st:param [
      st:text ( "Antiquité" "France" "Contexte" "Savoie, Piémont" "Comté de Nice");
      st:topic ( (cn:rome) (cn:fr) (cn:emp cn:context) (cn:mds) (cn:cdn)) ;      
      st:min -700 ;
      st:max 3000 ;
    ] .
    
    
 st:antiquity a st:Profile ;
    st:transform st:cdn ;    
    st:param [      
      st:text ( "Antiquité"  "France" "Contexte" );
      st:topic ( (cn:rome) (cn:fr) (cn:emp cn:context) ) ;      
      st:uri cn:I ;
      st:min -700 ;
      st:max 500 ;
    ] .
          

st:owlrl a st:Server ;
    st:service "owlrl" ;
    st:transform st:hturtle ;
    st:schema 
    [ st:uri <primer.owl> ] 
.


